# Kahani : Culturally-Nuanced Visual Storytelling Pipeline for Non-Western Cultures

#### Official Repository for ["Kahani : Culturally-Nuanced Visual Storytelling Pipeline for Non-Western Cultures"](https://arxiv.org/abs/2410.19419).

## Abstract

Large Language Models (LLMs) and Text-To-Image (T2I) models have demonstrated the ability to generate compelling text and visual stories. However, their outputs are predominantly aligned with the sensibilities of the Global North, often resulting in an outsider's gaze on other cultures. As a result, non-Western communities have to put extra effort into generating culturally specific stories. To address this challenge, we developed a visual storytelling pipeline called **Kahani** that generates culturally grounded visual stories for non-Western cultures. Our pipeline leverages off-the-shelf models GPT-4 Turbo and Stable Diffusion XL (SDXL). By using Chain of Thought (CoT) and T2I prompting techniques, we capture the cultural context from user's prompt and generate vivid descriptions of the characters and scene compositions. To evaluate the effectiveness of our pipeline, we conducted a comparative user study with ChatGPT-4 (with DALL-E3) in which participants from different regions of India compared the cultural relevance of stories generated by the two tools. Results from the qualitative and quantitative analysis performed on the user study showed that our pipeline was able to capture and incorporate more Culturally Specific Items (CSIs) compared to ChatGPT-4. In terms of both its cultural competence and visual story generation quality, our pipeline outperformed ChatGPT-4 in 27 out of the 36 comparisons. 

<p align="center">
<img width="321" alt="kahani gpt comparison sample" src="https://github.com/user-attachments/assets/b123e289-5a44-464d-8e7a-bc2fe6a4ed1f">
</p>

## Developer Notes:

Follow the given commands to setup and run this project and install necessary packages.

```
# Build the docker image
$ docker build . -t kahani-streaming

# Set up the environment variables
$ touch .env
$ vi .env
# Paste the below two env variables in the .env file and replace it with your API key and endpoint
# SDAPI_HOST=http://172.17.0.1:7860
# OPENAI_API_KEY=<OPENAI_API_KEY>

# To run the docker container from the built docker image
$ docker run -it -d -p 8080:8080 --env-file .env kahani-streaming
```
## Gradio Tool Snapshot

A snapshot of the Kahani Gradio Tool : 
<p align="center">
<img width="600" alt="gradio tool" src="https://github.com/user-attachments/assets/acd733ff-13e5-4ccf-b125-b910c2c0c313">
</p>

## Kahani Pipeline
<p align="center">
<img width="600" alt="kahani pipeline" src="https://github.com/user-attachments/assets/e1fac90a-b940-4a8a-8cdf-135530a44a72">
</p>

Our proposed visual storytelling pipeline consists of five primary steps starting from extracting details from the user story prompt and expanding on these details based on the story's cultural context, to generating cultural visuals for each scene. Prompts for each of the steps are provided in the `src/prompts` folder.

## Directory Structure

```
.
├── README.md
└── src
    ├── Dockerfile
    ├── api.py
    ├── app.py
    ├── avatar.png
    ├── kahani.py
    ├── llm.py
    ├── models.py
    ├── pipeline.yml
    ├── poetry.lock
    ├── prompts
    │   ├── __init__.py
    │   ├── base.py
    │   ├── bounding_box
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── break_story_into_scenes
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── classify_change
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── create_story
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── extract_characters
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── extract_culture
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── generate_character
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── generate_pose
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── generate_scenes
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   ├── summarise_culture
    │   │   ├── __init__.py
    │   │   ├── system.md
    │   │   └── user.md
    │   └── user_input
    │       ├── __init__.py
    │       ├── system.md
    │       └── user.md
    ├── pyproject.toml
    └── utils.py
```

## Citation

In case you use this work or pipeline, please use the following bibTEX to cite our work,

```
@misc{hamna2024kahaniculturallynuancedvisualstorytelling,
      title={KAHANI: Culturally-Nuanced Visual Storytelling Pipeline for Non-Western Cultures}, 
      author={Hamna and Deepthi Sudharsan and Agrima Seth and Ritvik Budhiraja and Deepika Khullar and Vyshak Jain and Kalika Bali and Aditya Vashistha and Sameer Segal},
      year={2024},
      eprint={2410.19419},
      archivePrefix={arXiv},
      primaryClass={cs.CL},
      url={https://arxiv.org/abs/2410.19419}, 
}
```

## Contributing

This project welcomes contributions and suggestions.  Most contributions require you to agree to a
Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us
the rights to use your contribution. For details, visit https://cla.opensource.microsoft.com.

When you submit a pull request, a CLA bot will automatically determine whether you need to provide
a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions
provided by the bot. You will only need to do this once across all repos using our CLA.

This project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/).
For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or
contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.

## Trademarks

This project may contain trademarks or logos for projects, products, or services. Authorized use of Microsoft 
trademarks or logos is subject to and must follow 
[Microsoft's Trademark & Brand Guidelines](https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general).
Use of Microsoft trademarks or logos in modified versions of this project must not cause confusion or imply Microsoft sponsorship.
Any use of third-party trademarks or logos are subject to those third-party's policies.

## Privacy

You can read more about Microsoft's privacy statement [here](https://go.microsoft.com/fwlink/?LinkId=521839).
