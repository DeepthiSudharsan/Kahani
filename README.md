# Kahani : Culturally-Nuanced Visual Storytelling Pipeline for Non-Western Cultures

#### Official Repository for "Kahani : Culturally-Nuanced Visual Storytelling Pipeline for Non-Western Cultures"

## Abstract

Large Language Models (LLMs) and Text-To-Image (T2I) models have demonstrated the ability to generate compelling text and visual stories. However, their outputs are predominantly aligned with the sensibilities of the Global North, often resulting in an outsider's gaze on other cultures. As a result, non-Western communities have to put extra effort into generating culturally specific stories. To address this challenge, we developed a visual storytelling pipeline called **Kahani** that generates culturally grounded visual stories for non-Western cultures. Our pipeline leverages off-the-shelf models GPT-4 Turbo and Stable Diffusion XL (SDXL). By using Chain of Thought (CoT) and T2I prompting techniques, we capture the cultural context from user's prompt and generate vivid descriptions of the characters and scene compositions. To evaluate the effectiveness of our pipeline, we conducted a comparative user study with ChatGPT-4 (with DALL-E3) in which participants from different regions of India compared the cultural relevance of stories generated by the two tools. Results from the qualitative and quantitative analysis performed on the user study showed that our pipeline was able to capture and incorporate more Culturally Specific Items (CSIs) compared to ChatGPT-4. In terms of both its cultural competence and visual story generation quality, our pipeline outperformed ChatGPT-4 in 27 out of the 36 comparisons. 

## Setup

## Developer Notes:

```
$ docker build . -t kahani-streaming
$ touch .env
$ vi .env
# SDAPI_HOST=http://172.17.0.1:7860
# OPENAI_API_KEY=<OPENAI_API_KEY>
$ docker run -it -d -p 8080:8080 --env-file .env kahani-streaming
```
## Directory Structure

```
.
├── CODE_OF_CONDUCT.md
├── Dockerfile
├── LICENSE
├── README.md
├── SECURITY.md
├── SUPPORT.md
├── api.py
├── app.py
├── avatar.png
├── kahani.py
├── llm.py
├── models.py
├── pipeline.yml
├── poetry.lock
├── prompts
│   ├── __init__.py
│   ├── base.py
│   ├── bounding_box
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── break_story_into_scenes
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── classify_change
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── create_story
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── extract_characters
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── extract_culture
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── generate_character
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── generate_pose
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── generate_scenes
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   ├── summarise_culture
│   │   ├── __init__.py
│   │   ├── system.md
│   │   └── user.md
│   └── user_input
│       ├── __init__.py
│       ├── system.md
│       └── user.md
├── pyproject.toml
├── terraform
│   ├── README.md
│   ├── backend.tf
│   ├── main.tf
│   ├── variables.tf
│   └── webapp.tf
├── tests
│   ├── generate_canny_image
│   │   └── monkey_ref-removebg-preview.png
│   ├── image_processing
│   │   ├── inputs
│   │   │   └── bala_pose_one.png
│   │   └── test_image_processing.py
│   ├── prompts
│   │   ├── Bounding_box
│   │   │   ├── bounding_box.py
│   │   │   ├── generate_bb_image.py
│   │   │   ├── inputs
│   │   │   │   ├── scene0_Bala.png
│   │   │   │   ├── scene0_Simba.png
│   │   │   │   ├── scene1_Bala.png
│   │   │   │   └── scene1_Simba.png
│   │   │   └── object_detection
│   │   │       └── inputs
│   │   │           ├── Bala_bb.png
│   │   │           ├── Simba_bb.png
│   │   │           ├── girl_cropped.png
│   │   │           └── uncle_cropped.png
│   │   ├── Generate_pose
│   │   │   ├── bala_api_ref_img.png
│   │   │   ├── bala_pose.png
│   │   │   ├── bala_pose_one.png
│   │   │   ├── bala_pose_two.png
│   │   │   ├── bala_ref_img.png
│   │   │   ├── bala_token.png
│   │   │   ├── generate_pose.py
│   │   │   ├── generate_pose_image.py
│   │   │   ├── inputs
│   │   │   │   └── character_gen_Bala.png
│   │   │   ├── simba_pose_one.png
│   │   │   ├── simba_pose_two.png
│   │   │   ├── simba_ref_img.png
│   │   │   └── simba_token.png
│   │   ├── Generate_scene
│   │   │   ├── Generate_canny_image
│   │   │   │   ├── canny_bb_scene0.png
│   │   │   │   ├── canny_bb_test.png
│   │   │   │   ├── canny_test_output.png
│   │   │   │   ├── canny_testing.png
│   │   │   │   ├── object_detection_bb.png
│   │   │   │   ├── scene0_bounding_box.png
│   │   │   │   ├── scene1_bounding_box.png
│   │   │   │   ├── scene_0_bounding_box_test.png
│   │   │   │   └── test_canny_image.py
│   │   │   ├── generate_scene_image.py
│   │   │   ├── generate_scenes.py
│   │   │   └── inputs
│   │   │       ├── Geetha_kneeling.png
│   │   │       ├── ananda_relieved.png
│   │   │       ├── bala_pose_one.png
│   │   │       ├── canny_bb_scene0.png
│   │   │       ├── canny_bb_test.png
│   │   │       ├── canny_image.png
│   │   │       ├── object_detection_bb.png
│   │   │       ├── ref_scene_12.png
│   │   │       ├── reference_image_scene0.png
│   │   │       ├── reference_image_scene10.png
│   │   │       ├── scene0_Bala.png
│   │   │       ├── scene0_Simba.png
│   │   │       ├── scene0_character_Bala.png
│   │   │       ├── scene0_character_Simba.png
│   │   │       ├── scene12_Bala.png
│   │   │       ├── scene3_bounding_box.png
│   │   │       ├── scene_10_bounding_box.png
│   │   │       └── simba_pose_one.png
│   │   ├── break_story_into_scenes.py
│   │   ├── classify_change.py
│   │   ├── create_story.py
│   │   ├── extract_characters.py
│   │   ├── extract_culture.py
│   │   ├── generate_character.py
│   │   └── summarise_culture.py
│   ├── ref_guided_inpainting
│   │   ├── neg_prompt.txt
│   │   ├── prompt.txt
│   │   └── reference_guided_inpainting.py
│   ├── ref_img_gen
│   │   ├── generate_final_image_from_reference_image.py
│   │   └── prompt.txt
│   ├── remove_bg.py
│   ├── test_concat_images.py
│   ├── test_crop.py
│   ├── test_crop2.py
│   └── test_text_2_char_img.py
└── utils.py
```

## Citation

In case you use this work or pipeline, please cite our work,

```
```

## Contributing

This project welcomes contributions and suggestions.  Most contributions require you to agree to a
Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us
the rights to use your contribution. For details, visit https://cla.opensource.microsoft.com.

When you submit a pull request, a CLA bot will automatically determine whether you need to provide
a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions
provided by the bot. You will only need to do this once across all repos using our CLA.

This project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/).
For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or
contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.

## Trademarks

This project may contain trademarks or logos for projects, products, or services. Authorized use of Microsoft 
trademarks or logos is subject to and must follow 
[Microsoft's Trademark & Brand Guidelines](https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general).
Use of Microsoft trademarks or logos in modified versions of this project must not cause confusion or imply Microsoft sponsorship.
Any use of third-party trademarks or logos are subject to those third-party's policies.

## Privacy

You can read more about Microsoft's privacy statement [here](https://go.microsoft.com/fwlink/?LinkId=521839).
